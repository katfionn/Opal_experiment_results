<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的数字日记</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style type="text/tailwindcss">
        @layer base {
            html {
                font-family: 'Inter', sans-serif;
            }
            h1, h2, h3, h4, h5, h6 {
                font-family: 'Outfit', sans-serif;
            }
        }
        @layer utilities {
            .bg-glass {
                background-color: hsla(240, 10%, 15%, 0.7); /* Slightly lighter, translucent dark blue/grey */
                backdrop-filter: blur(10px) saturate(180%);
                -webkit-backdrop-filter: blur(10px) saturate(180%);
                border: 1px solid hsla(270, 50%, 40%, 0.3); /* Subtle purple border */
            }
            .btn-primary {
                background: linear-gradient(135deg, hsla(270, 80%, 65%, 1) 0%, hsla(200, 80%, 60%, 1) 100%);
                color: hsl(0, 0%, 95%);
                @apply font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-300 ease-in-out hover:scale-[1.03] hover:shadow-2xl focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-purple;
            }
            .btn-secondary {
                background-color: hsla(240, 15%, 25%, 1); /* Darker grey */
                color: hsl(0, 0%, 85%);
                @apply font-medium py-3 px-6 rounded-xl shadow-md transition-all duration-300 ease-in-out hover:bg-opacity-80 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500;
            }
            .textarea-custom {
                background-color: hsla(240, 10%, 12%, 0.6); /* Even darker, subtle translucency */
                border: 1px solid hsla(270, 50%, 40%, 0.2);
                color: hsl(0, 0%, 90%);
                @apply rounded-xl p-5 text-lg resize-none focus:ring-2 focus:ring-accent-purple focus:outline-none placeholder:text-gray-500;
            }
            /* Custom scrollbar for webkit browsers */
            .textarea-custom::-webkit-scrollbar {
                width: 10px;
            }
            .textarea-custom::-webkit-scrollbar-track {
                background: hsla(240, 10%, 10%, 0.5);
                border-radius: 10px;
            }
            .textarea-custom::-webkit-scrollbar-thumb {
                background: hsla(270, 60%, 55%, 0.7);
                border-radius: 10px;
                border: 2px solid hsla(240, 10%, 12%, 0.6);
            }
            .textarea-custom::-webkit-scrollbar-thumb:hover {
                background: hsla(270, 70%, 60%, 0.8);
            }
            .custom-scrollbar::-webkit-scrollbar {
                width: 8px;
            }
            .custom-scrollbar::-webkit-scrollbar-track {
                background: hsla(240, 10%, 15%, 0.3);
                border-radius: 10px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb {
                background: hsla(270, 60%, 55%, 0.5);
                border-radius: 10px;
            }
            .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                background: hsla(270, 70%, 60%, 0.7);
            }
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': 'hsl(240, 10%, 10%)',
                        'card-bg': 'hsla(240, 10%, 15%, 0.7)',
                        'accent-purple': 'hsl(270, 80%, 65%)',
                        'accent-blue': 'hsl(200, 80%, 60%)',
                        'text-light': 'hsl(0, 0%, 90%)',
                        'text-subtle': 'hsl(0, 0%, 60%)',
                        'border-subtle': 'hsla(270, 50%, 40%, 0.3)',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Outfit', 'sans-serif'],
                    },
                    keyframes: {
                        blob: {
                            '0%, 100%': { transform: 'translate(0, 0) scale(1)' },
                            '30%': { transform: 'translate(10%, -10%) scale(1.1)' },
                            '60%': { transform: 'translate(-15%, 15%) scale(0.9)' },
                        }
                    },
                    animation: {
                        blob: 'blob 7s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55)',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-primary-dark text-text-light flex items-center justify-center p-4 selection:bg-accent-purple selection:text-white relative overflow-hidden">

    <!-- Background Gradients / Effects -->
    <div class="absolute inset-0 z-0 opacity-40">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-accent-purple rounded-full mix-blend-screen filter blur-3xl opacity-50 animate-blob"></div>
        <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-accent-blue rounded-full mix-blend-screen filter blur-3xl opacity-50 animate-blob animation-delay-2000"></div>
    </div>

    <div class="relative z-10 w-full max-w-4xl mx-auto p-6 md:p-10 bg-glass rounded-3xl shadow-2xl flex flex-col gap-8 transform hover:scale-[1.005] transition-all duration-500 ease-in-out">

        <!-- Header and Date -->
        <header class="text-center mb-6">
            <h1 class="font-display text-5xl md:text-6xl font-extrabold mb-3 bg-clip-text text-transparent bg-gradient-to-r from-accent-purple to-accent-blue leading-tight">
                我的数字日记
            </h1>
            <p id="current-date" class="text-xl md:text-2xl font-light text-text-subtle mt-2 animate-pulse"></p>
        </header>

        <!-- Diary Entry Area -->
        <textarea id="diary-entry" class="textarea-custom w-full h-80 min-h-[200px] md:min-h-[300px] placeholder:italic" placeholder="今天有什么值得记录的呢？写下你的思绪..."></textarea>

        <!-- Action Buttons -->
        <div class="flex flex-col md:flex-row gap-4 justify-end items-center">
            <button id="save-btn" class="btn-primary w-full md:w-auto">保存到本地</button>
            <button id="email-btn" class="btn-secondary w-full md:w-auto flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                </svg>
                通过邮件发送
            </button>
            <button id="load-btn" class="btn-secondary w-full md:w-auto flex items-center justify-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z" clip-rule="evenodd" />
                </svg>
                恢复本地记录
            </button>
        </div>

        <!-- Notification / Toast Message -->
        <div id="notification-area" class="fixed top-6 right-6 z-50 flex flex-col gap-3 pointer-events-none">
            <!-- Notifications will be injected here -->
        </div>

        <!-- Load Entries Modal -->
        <div id="load-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-40 hidden p-4">
            <div class="bg-glass rounded-2xl p-6 w-full max-w-md shadow-2xl scale-95 opacity-0 transition-all duration-300 ease-out" id="modal-content">
                <h3 class="font-display text-3xl font-bold mb-5 text-center bg-clip-text text-transparent bg-gradient-to-r from-accent-purple to-accent-blue">选择日记记录</h3>
                <ul id="entry-list" class="max-h-60 overflow-y-auto custom-scrollbar border border-border-subtle rounded-xl p-3 mb-6 bg-primary-dark bg-opacity-30">
                    <li class="p-3 text-text-subtle text-center">暂无本地记录</li>
                </ul>
                <div class="flex justify-center">
                    <button id="close-modal-btn" class="btn-secondary py-2 px-5">关闭</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const diaryEntryEl = document.getElementById('diary-entry');
            const currentDateEl = document.getElementById('current-date');
            const saveBtn = document.getElementById('save-btn');
            const emailBtn = document.getElementById('email-btn');
            const loadBtn = document.getElementById('load-btn');
            const notificationArea = document.getElementById('notification-area');
            const loadModal = document.getElementById('load-modal');
            const modalContent = document.getElementById('modal-content');
            const entryList = document.getElementById('entry-list');
            const closeModalBtn = document.getElementById('close-modal-btn');

            // --- Utility Functions ---
            const formatDate = (date) => {
                const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
                return date.toLocaleDateString('zh-CN', options);
            };

            const formatTimestamp = (timestamp) => {
                const date = new Date(parseInt(timestamp, 10));
                const options = { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return date.toLocaleDateString('zh-CN', options);
            };

            const showNotification = (message, type = 'success') => {
                const notification = document.createElement('div');
                notification.className = `p-4 rounded-lg shadow-md text-sm font-medium transition-all duration-300 transform translate-x-full opacity-0 whitespace-nowrap`;

                if (type === 'success') {
                    notification.classList.add('bg-green-600', 'text-white');
                } else if (type === 'error') {
                    notification.classList.add('bg-red-600', 'text-white');
                } else { // info
                    notification.classList.add('bg-blue-600', 'text-white');
                }
                notification.textContent = message;
                notificationArea.appendChild(notification);

                setTimeout(() => {
                    notification.classList.remove('translate-x-full', 'opacity-0');
                    notification.classList.add('translate-x-0', 'opacity-100');
                }, 10); // Small delay for animation trigger

                setTimeout(() => {
                    notification.classList.remove('translate-x-0', 'opacity-100');
                    notification.classList.add('translate-x-full', 'opacity-0');
                    notification.addEventListener('transitionend', () => notification.remove());
                }, 3000);
            };

            // --- Core Functionality ---

            // Display current date
            currentDateEl.textContent = formatDate(new Date());

            // Load last edited entry on page load
            const loadLastEntry = () => {
                try {
                    const allEntries = JSON.parse(localStorage.getItem('myDigitalDiaryEntries') || '{}');
                    const sortedTimestamps = Object.keys(allEntries).sort((a, b) => parseInt(b, 10) - parseInt(a, 10)); // Newest first
                    if (sortedTimestamps.length > 0) {
                        diaryEntryEl.value = allEntries[sortedTimestamps[0]];
                        // showNotification('已加载最新记录。', 'info'); // Commented out to reduce initial clutter
                    }
                } catch (e) {
                    console.error('Failed to load last entry:', e);
                    showNotification('加载最新记录失败。', 'error');
                }
            };
            loadLastEntry();


            // Save entry to local storage
            saveBtn.addEventListener('click', () => {
                const entryContent = diaryEntryEl.value.trim();
                if (!entryContent) {
                    showNotification('日记内容不能为空！', 'error');
                    return;
                }

                const timestamp = Date.now().toString();
                try {
                    const allEntries = JSON.parse(localStorage.getItem('myDigitalDiaryEntries') || '{}');
                    allEntries[timestamp] = entryContent;
                    localStorage.setItem('myDigitalDiaryEntries', JSON.stringify(allEntries));
                    showNotification('日记已成功保存到本地！', 'success');
                } catch (e) {
                    console.error('Failed to save entry:', e);
                    showNotification('保存日记失败，请检查本地存储。', 'error');
                }
            });

            // Email entry
            emailBtn.addEventListener('click', () => {
                const entryContent = diaryEntryEl.value.trim();
                if (!entryContent) {
                    showNotification('日记内容不能为空，无法发送邮件。', 'error');
                    return;
                }
                const subject = `我的日记记录 - ${formatDate(new Date())}`;
                const body = `日期: ${formatDate(new Date())}\n\n${entryContent}\n\n-- 我的数字日记`;
                window.open(`mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
                showNotification('已准备通过邮件发送日记。', 'info');
            });

            // Load entries functionality
            loadBtn.addEventListener('click', () => {
                try {
                    const allEntries = JSON.parse(localStorage.getItem('myDigitalDiaryEntries') || '{}');
                    const timestamps = Object.keys(allEntries).sort((a, b) => parseInt(b, 10) - parseInt(a, 10)); // Newest first

                    entryList.innerHTML = ''; // Clear previous list

                    if (timestamps.length === 0) {
                        const li = document.createElement('li');
                        li.className = 'p-3 text-text-subtle text-center text-opacity-70 italic';
                        li.textContent = '暂无本地记录';
                        entryList.appendChild(li);
                    } else {
                        timestamps.forEach(timestamp => {
                            const li = document.createElement('li');
                            li.className = 'p-3 cursor-pointer hover:bg-card-bg hover:rounded-lg transition-colors duration-200 ease-in-out border-b border-border-subtle last:border-b-0 text-text-light text-opacity-90';
                            li.textContent = formatTimestamp(timestamp);
                            li.dataset.timestamp = timestamp;
                            li.addEventListener('click', () => {
                                diaryEntryEl.value = allEntries[timestamp];
                                showNotification(`已加载 ${formatTimestamp(timestamp)} 的记录。`, 'success');
                                closeModal();
                            });
                            entryList.appendChild(li);
                        });
                    }
                    openModal();
                } catch (e) {
                    console.error('Failed to load entries list:', e);
                    showNotification('加载本地记录列表失败。', 'error');
                }
            });

            // Modal functionality
            const openModal = () => {
                loadModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            };

            const closeModal = () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                modalContent.addEventListener('transitionend', () => {
                    loadModal.classList.add('hidden');
                }, { once: true });
            };

            closeModalBtn.addEventListener('click', closeModal);
            loadModal.addEventListener('click', (e) => {
                if (e.target === loadModal) { // Clicked outside the modal content
                    closeModal();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !loadModal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
